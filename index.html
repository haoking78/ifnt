<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>ç„¡é™ç¿»è½‰äººç”Ÿ Â· IFNT</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" href="app_icon_192.png">
<meta name="theme-color" content="#1E88E5">
<style>
:root{
  --bg:#0b1520; --panel:#0f2233; --chip:#16344e; --ring:#244c68;
  --text:#eaf4ff; --muted:#97b6cf; --accent:#1e88e5; --accent2:#5ec8f5;
  --ok:#22d397; --bad:#ff6b6b;
  --shadow:0 10px 26px rgba(0,0,0,.35);
  --r:14px;
}
*{box-sizing:border-box}
html,body{margin:0;background:linear-gradient(180deg,#07131e,#0b1520 70%);color:var(--text);
  font-family:system-ui,-apple-system,"Noto Sans TC","PingFang TC","Microsoft JhengHei",Segoe UI,Roboto,sans-serif}
.wrap{max-width:980px;margin:0 auto;padding:18px 16px 80px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;position:sticky;top:0;z-index:10;
  background:linear-gradient(180deg,rgba(11,21,32,.95),rgba(11,21,32,.4));backdrop-filter:blur(6px);padding:12px 0}
.hleft{display:flex;align-items:center;gap:12px}
.logo{width:38px;height:38px;border-radius:10px;background:#000 url(app_icon_192.png) center/cover no-repeat;box-shadow:inset 0 0 0 1px #244c68}
.title{font-size:20px;font-weight:800;letter-spacing:.4px}
.tag{display:inline-block;padding:4px 10px;border:1px solid var(--ring);border-radius:999px;background:var(--chip);color:var(--muted);font-size:12px}
.btn{appearance:none;border:1px solid var(--ring);background:var(--chip);color:#fff;border-radius:12px;padding:10px 14px;cursor:pointer;box-shadow:var(--shadow);font-weight:700}
.btn:hover{filter:brightness(1.05)}
.btn.warn{background:#3a2a00;border-color:#5b4300;color:#ffd166}
.panel{background:var(--panel);border:1px solid var(--ring);border-radius:18px;box-shadow:var(--shadow);padding:16px;margin:14px 0}
.h2{font-size:18px;margin:4px 0 12px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:740px){.grid{grid-template-columns:1fr}}
label{font-size:13px;color:var(--muted);display:block;margin:6px 2px}
.input, select, textarea{width:100%;max-width:100%;appearance:none;-webkit-appearance:none;background:rgba(255,255,255,.06);color:var(--text);
  border:1px solid var(--ring);border-radius:12px;padding:12px;font-size:16px;outline:none}
/* iOS date width fix */
input[type="date"]{width:100%!important;max-width:100%!important;appearance:none;-webkit-appearance:none}
textarea{min-height:100px;resize:vertical}
.table{width:100%;border-collapse:collapse;margin-top:10px}
.table th,.table td{border-bottom:1px dashed rgba(255,255,255,.14);padding:10px 8px;font-size:14px;text-align:left}
.kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.card{background:rgba(255,255,255,.04);border:1px solid var(--ring);border-radius:14px;padding:12px}
.big{font-size:22px;font-weight:800}
.badge{display:inline-block;padding:3px 8px;border-radius:8px;font-size:12px}
.badge.ok{background:#0b3d2b;color:#92f3c6;border:1px solid #14684b}
.badge.miss{background:#3b1b1b;color:#ffb2b2;border:1px solid #5a2a2a}
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
/* datalist hint icon */
.input-icon{position:relative;display:flex;align-items:center}
.input-icon input{flex:1;padding-right:28px}
.input-icon .hint{position:absolute;right:10px;color:var(--muted);font-size:12px;pointer-events:none}
.muted{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="hleft">
      <div class="logo"></div>
      <div class="title">ç„¡é™ç¿»è½‰äººç”Ÿ Â· IFNT</div>
      <span class="tag">v4 Â· ä»…ä¸€éµåŒ¯å‡º Â· æœ¬æ©Ÿå„²å­˜</span>
    </div>
    <div class="actions">
      <button class="btn" id="btnExport">ä¸€éµåŒ¯å‡º CSV</button>
      <button class="btn warn" id="btnClear">æ¸…ç©ºå…¨éƒ¨</button>
    </div>
  </div>

  <div class="panel">
    <div class="h2">ğŸ§­ é€²åº¦ç¸½è¦½</div>
    <div class="kpi">
      <div class="card"><div class="muted">è¦ªè‡ªæ‹›å‹Ÿ</div><div class="big" id="kpiR">0 / 1</div></div>
      <div class="card"><div class="muted">é›¶å”®ï¼‹è‡ªè³¼ BV</div><div class="big"><span id="sumBV">0</span> / 1500</div></div>
      <div class="card"><div class="muted">å®¶åº­è½‰ç§» IBV</div><div class="big"><span id="sumIBV">0</span> / 300</div></div>
    </div>
  </div>

  <!-- Recruit -->
  <div class="panel">
    <div class="h2">â‘  è¦ªè‡ªæ‹›å‹Ÿ 1 äºº</div>
    <div class="grid">
      <div>
        <label>æ—¥æœŸ</label>
        <input type="date" id="rDate" class="input">
      </div>
      <div>
        <label>æ‹›å‹Ÿå§“åï¼ˆå¿…å¡«ï¼‰</label>
        <div class="input-icon">
          <input list="nameList" id="rName" class="input" placeholder="è¼¸å…¥æˆ–é¸æ“‡å§“å">
          <span class="hint">â–¼</span>
        </div>
      </div>
    </div>
    <div class="actions">
      <button class="btn" id="addR">æ–°å¢æ‹›å‹Ÿ</button>
    </div>
    <table class="table" id="tblR"><thead><tr><th>#</th><th>æ—¥æœŸ</th><th>å§“å</th><th>æ“ä½œ</th></tr></thead><tbody></tbody></table>
  </div>

  <!-- BV -->
  <div class="panel">
    <div class="h2">â‘¡ é›¶å”®ï¼‹è‡ªè³¼ 1500 BV</div>
    <div class="grid">
      <div>
        <label>æ—¥æœŸ</label>
        <input type="date" id="bDate" class="input">
      </div>
      <div>
        <label>é¡§å®¢å§“åï¼ˆå¯ç©ºï¼‰</label>
        <div class="input-icon">
          <input list="nameList" id="bName" class="input" placeholder="è¼¸å…¥æˆ–é¸æ“‡å§“å">
          <span class="hint">â–¼</span>
        </div>
      </div>
      <div>
        <label>é›¶å”®å“é …ï¼ˆä¾‹å¦‚ï¼šå¹³æ³°ç§€ã€OPCã€NADï¼‰</label>
        <input id="bItem" class="input" placeholder="ä¾‹å¦‚ï¼šå¹³æ³°ç§€ã€OPCã€NAD">
      </div>
      <div>
        <label>é›¶å”® BVï¼ˆå¿…å¡«ï¼‰</label>
        <input type="number" id="bBV" class="input" placeholder="ä¾‹å¦‚ï¼š300">
      </div>
    </div>
    <div class="actions">
      <button class="btn" id="addBV">æ–°å¢ BV</button>
    </div>
    <div class="muted" id="leftBV">è·é›¢ 1500 é‚„å·®ï¼š1500 BV</div>
    <table class="table" id="tblBV"><thead><tr><th>#</th><th>æ—¥æœŸ</th><th>å§“å</th><th>å“é …</th><th>BV</th><th>æ“ä½œ</th></tr></thead><tbody></tbody></table>
  </div>

  <!-- IBV -->
  <div class="panel">
    <div class="h2">â‘¢ å®¶åº­è½‰ç§»æ¶ˆè²» 300 IBV</div>
    <div class="grid">
      <div>
        <label>æ—¥æœŸ</label>
        <input type="date" id="iDate" class="input">
      </div>
      <div>
        <label>æ¶ˆè²»å°è±¡ï¼ˆå¿«é¸æˆ–è¼¸å…¥ï¼‰</label>
        <div class="input-icon">
          <input list="groupList" id="iPerson" class="input" placeholder="ä¾‹å¦‚ï¼šè‡ªå·±ã€å®¶äººã€æœ‹å‹">
          <span class="hint">â–¼</span>
        </div>
      </div>
      <div>
        <label>æ¶ˆè²»å“é …ï¼ˆä¾‹å¦‚ï¼šä¿å¥å“ã€å®¶é›»ã€æ—¥ç”¨å“ï¼‰</label>
        <input id="iItem" class="input" placeholder="ä¾‹å¦‚ï¼šä¿å¥å“ã€å®¶é›»ã€æ—¥ç”¨å“">
      </div>
      <div>
        <label>IBVï¼ˆå¿…å¡«ï¼‰</label>
        <input type="number" id="iIBV" class="input" placeholder="ä¾‹å¦‚ï¼š20">
      </div>
    </div>
    <div class="actions">
      <button class="btn" id="addIBV">æ–°å¢ IBV</button>
    </div>
    <div class="muted" id="leftIBV">è·é›¢ 300 é‚„å·®ï¼š300 IBV</div>
    <table class="table" id="tblIBV"><thead><tr><th>#</th><th>æ—¥æœŸ</th><th>å°è±¡</th><th>å“é …</th><th>IBV</th><th>æ“ä½œ</th></tr></thead><tbody></tbody></table>
  </div>

  <!-- Contacts -->
  <div class="panel">
    <div class="h2">â‘£ 312 äº’å‹•åå–®</div>
    <div class="grid">
      <div>
        <label>å±…ä½ç¸£å¸‚</label>
        <select id="cCity" class="input"></select>
      </div>
      <div>
        <label>å§“åï¼ˆå¿«é¸æˆ–è¼¸å…¥ï¼Œå¿…å¡«ï¼‰</label>
        <div class="input-icon">
          <input list="nameList" id="cName" class="input" placeholder="è¼¸å…¥æˆ–é¸æ“‡å§“å">
          <span class="hint">â–¼</span>
        </div>
      </div>
      <div>
        <label>æ—ç¾¤ / é—œä¿‚ï¼ˆä¾‹å¦‚ï¼šåœ‹å°åŒå­¸ã€å®¢æˆ¶ã€è¦ªæˆšï¼‰</label>
        <div class="input-icon">
          <input list="groupList" id="cGroup" class="input" placeholder="ä¾‹å¦‚ï¼šåœ‹å°åŒå­¸ã€å®¢æˆ¶ã€è¦ªæˆš">
          <span class="hint">â–¼</span>
        </div>
      </div>
      <div>
        <label>äº’å‹•æ—¥æœŸ</label>
        <input type="date" id="cDate" class="input">
      </div>
    </div>
    <label>äº’å‹•æƒ…æ³ / å‚™è¨»ï¼ˆå¯è¼¸å…¥å¾ˆå¤šå…§å®¹ï¼‰</label>
    <textarea id="cNote" class="input" placeholder="äº’å‹•å…§å®¹ã€å°æ–¹ç‹€æ³ã€ä¸‹æ¬¡è·Ÿé€²é»â€¦"></textarea>
    <div class="actions">
      <button class="btn" id="addC">æ–°å¢ / æ›´æ–°äº’å‹•</button>
    </div>
    <table class="table" id="tblC"><thead><tr><th>#</th><th>ç¸£å¸‚</th><th>å§“å</th><th>æ—ç¾¤</th><th>æ—¥æœŸ</th><th>å…§å®¹</th><th>æ“ä½œ</th></tr></thead><tbody></tbody></table>
  </div>

  <datalist id="nameList"></datalist>
  <datalist id="groupList"></datalist>
</div>

<script>
const $ = s=>document.querySelector(s);
const $$ = s=>[...document.querySelectorAll(s)];
const today = ()=>{const d=new Date();const p=n=>String(n).padStart(2,'0');return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())}`}

const KEY='ifnt-v4';
let DB = JSON.parse(localStorage.getItem(KEY) || '{"recruits":[],"bvs":[],"ibvs":[],"contacts":[],"names":[],"groups":[]}');
const counties = ["åŸºéš†å¸‚","è‡ºåŒ—å¸‚","æ–°åŒ—å¸‚","æ¡ƒåœ’å¸‚","æ–°ç«¹å¸‚","æ–°ç«¹ç¸£","è‹—æ —ç¸£","è‡ºä¸­å¸‚","å½°åŒ–ç¸£","å—æŠ•ç¸£","é›²æ—ç¸£","å˜‰ç¾©å¸‚","å˜‰ç¾©ç¸£","è‡ºå—å¸‚","é«˜é›„å¸‚","å±æ±ç¸£","å®œè˜­ç¸£","èŠ±è“®ç¸£","è‡ºæ±ç¸£","æ¾æ¹–ç¸£","é‡‘é–€ç¸£","é€£æ±Ÿç¸£"];
$('#cCity').innerHTML = '<option value="">è«‹é¸æ“‡</option>' + counties.map(c=>`<option>${c}</option>`).join('');

['rDate','bDate','iDate','cDate'].forEach(id=>{ const el=$('#'+id); if(el) el.value=today(); });

function save(){ localStorage.setItem(KEY, JSON.stringify(DB)); render(); }
function addName(n){ if(n && !DB.names.includes(n)) DB.names.push(n); }
function addGroup(g){ if(g && !DB.groups.includes(g)) DB.groups.push(g); }
function renderLists(){
  $('#nameList').innerHTML = DB.names.map(v=>`<option value="${v}">`).join('');
  $('#groupList').innerHTML = DB.groups.map(v=>`<option value="${v}">`).join('');
}
function renderKPI(){
  $('#kpiR').textContent = `${DB.recruits.length} / 1`;
  const bv=DB.bvs.reduce((a,b)=>a+(Number(b.bv)||0),0);
  const ibv=DB.ibvs.reduce((a,b)=>a+(Number(b.ibv)||0),0);
  $('#sumBV').textContent=bv; $('#sumIBV').textContent=ibv;
  $('#leftBV').textContent = `è·é›¢ 1500 é‚„å·®ï¼š${Math.max(0,1500-bv)} BV`;
  $('#leftIBV').textContent = `è·é›¢ 300 é‚„å·®ï¼š${Math.max(0,300-ibv)} IBV`;
}
function renderTables(){
  // recruits
  const tbR = $('#tblR tbody'); tbR.innerHTML='';
  DB.recruits.forEach((r,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${r.date||''}</td><td>${r.name||''}</td><td><button class="btn" data-act="del" data-type="r" data-i="${i}">åˆªé™¤</button></td>`;
    tbR.appendChild(tr);
  });
  // bvs
  const tbB = $('#tblBV tbody'); tbB.innerHTML='';
  DB.bvs.forEach((r,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${r.date||''}</td><td>${r.name||''}</td><td>${r.item||''}</td><td>${r.bv||0}</td><td><button class="btn" data-act="del" data-type="b" data-i="${i}">åˆªé™¤</button></td>`;
    tbB.appendChild(tr);
  });
  // ibvs
  const tbI = $('#tblIBV tbody'); tbI.innerHTML='';
  DB.ibvs.forEach((r,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${r.date||''}</td><td>${r.person||''}</td><td>${r.item||''}</td><td>${r.ibv||0}</td><td><button class="btn" data-act="del" data-type="i" data-i="${i}">åˆªé™¤</button></td>`;
    tbI.appendChild(tr);
  });
  // contacts
  const tbC = $('#tblC tbody'); tbC.innerHTML='';
  DB.contacts.forEach((r,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${r.city||''}</td><td>${r.name||''}</td><td>${r.group||''}</td><td>${r.date||''}</td><td>${(r.note||'').replace(/\\n/g,'<br>')}</td><td><button class="btn" data-act="del" data-type="c" data-i="${i}">åˆªé™¤</button></td>`;
    tbC.appendChild(tr);
  });
}
function render(){ renderLists(); renderKPI(); renderTables(); }
render();

// events
document.addEventListener('click', (e)=>{
  const t = e.target; const act=t.getAttribute('data-act');
  if(act==='del'){
    const typ=t.getAttribute('data-type'); const i=+t.getAttribute('data-i');
    if(typ==='r') DB.recruits.splice(i,1);
    if(typ==='b') DB.bvs.splice(i,1);
    if(typ==='i') DB.ibvs.splice(i,1);
    if(typ==='c') DB.contacts.splice(i,1);
    save();
  }
});

$('#addR').onclick = ()=>{
  const date=$('#rDate').value||today(); const name=$('#rName').value.trim();
  if(!name){ alert('è«‹è¼¸å…¥æ‹›å‹Ÿå§“å'); return; }
  DB.recruits.push({date,name}); addName(name); save();
  $('#rName').value='';
};
$('#addBV').onclick = ()=>{
  const date=$('#bDate').value||today(); const name=$('#bName').value.trim();
  const item=$('#bItem').value.trim(); const bv=Number($('#bBV').value||0);
  if(!bv){ alert('è«‹è¼¸å…¥ BV'); return; }
  DB.bvs.push({date,name,item,bv}); if(name) addName(name); save();
  $('#bName').value=''; $('#bItem').value=''; $('#bBV').value='';
};
$('#addIBV').onclick = ()=>{
  const date=$('#iDate').value||today(); const person=$('#iPerson').value.trim();
  const item=$('#iItem').value.trim(); const ibv=Number($('#iIBV').value||0);
  if(!ibv){ alert('è«‹è¼¸å…¥ IBV'); return; }
  DB.ibvs.push({date,person,item,ibv}); if(person) addGroup(person); save();
  $('#iPerson').value=''; $('#iItem').value=''; $('#iIBV').value='';
};
$('#addC').onclick = ()=>{
  const city=$('#cCity').value; const name=$('#cName').value.trim();
  const group=$('#cGroup').value.trim(); const date=$('#cDate').value||today(); const note=$('#cNote').value.trim();
  if(!name){ alert('è«‹è¼¸å…¥å§“å'); return; }
  DB.contacts.push({city,name,group,date,note}); if(name) addName(name); if(group) addGroup(group); save();
  $('#cNote').value='';
};

$('#btnExport').onclick = ()=>{
  const rows=[["section","date","name","item_or_group","amount","city","note"]];
  DB.recruits.forEach(x=>rows.push(["recruit",x.date||"",x.name||"","","","",""]));
  DB.bvs.forEach(x=>rows.push(["bv",x.date||"",x.name||"",x.item||"",x.bv||0,"",""]));
  DB.ibvs.forEach(x=>rows.push(["ibv",x.date||"",x.person||"",x.item||"",x.ibv||0,"",""]));
  DB.contacts.forEach(x=>rows.push(["contact",x.date||"",x.name||"",x.group||"","",x.city||"", (x.note||"").replace(/\n/g,' ')]));
  const csv = rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(",")).join("\r\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = `IFNT_export_${new Date().toISOString().slice(0,10)}.csv`; a.click();
};

$('#btnClear').onclick = ()=>{
  if(!confirm('ç¢ºå®šè¦æ¸…ç©ºæœ¬æ©Ÿæ‰€æœ‰è³‡æ–™ï¼Ÿ')) return;
  DB={"recruits":[],"bvs":[],"ibvs":[],"contacts":[],"names":[],"groups":[]};
  localStorage.setItem(KEY, JSON.stringify(DB)); render();
};
</script>
</body>
</html>
